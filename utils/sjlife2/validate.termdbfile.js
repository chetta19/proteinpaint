/*
given input of a termdb file (e.g. generated by the prs pipeline at ./PRS/termdb.prs)
Note that the input termdb file should only have 5 columns, so the PRS production pipeline doesn't need to change

validate the json field of each line
and print valid lines to stdout
exit on error
*/
if (process.argv.length != 3) {
	console.log('<termdb file> output valid lines to stdout')
	process.exit()
}
console.error('RUNNING validate.termdbfile.js ...')

const fs = require('fs')
for (const line of fs
	.readFileSync(process.argv[2], { encoding: 'utf8' })
	.trim()
	.split('\n')) {
	const l = line.split('\t')

	if (l.length != 5) throw 'line not having 5 columns: ' + line

	let j
	try {
		j = JSON.parse(l[3])
	} catch (e) {
		throw 'invalid json: ' + line
	}
	if (!Number.isInteger(Number(l[4]))) throw '5th field not integer: ' + line
	console.log(
		line +
		'\t' +
		(j.type || '') + // add 6th column
			'\t' +
			(j.isleaf ? 1 : 0) // add 7th column
	)
}
