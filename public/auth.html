<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  <script src="bin/proteinpaint.js" charset="utf-8"></script>
</head>
<body>
<noscript>This page requires JavaScript. Please enable it in your browser settings.</noscript>
<div id=aaa style="margin:10px"></div>
<script>
const maxTries = 1
let numTries=0
function run() {
  const params = getParams()
  if (!params.dslabel) {
    alert(`Missing a 'dslabel=' URL parameter`)
    return
  }

  const pw = prompt('Please enter a password')
  numTries++

  fetch('/dslogin', {
    method: 'POST',
    headers: {
      authorization: `Basic ${btoa(pw)}`
    },
    body: JSON.stringify({
      dslabel: params.dslabel
    })
  })
  .then(res => res.json())
  .then(res=>{
    if (res.error) throw res.error
    runproteinpaint({
      holder:document.getElementById('aaa'),
      parseurl:true,
    })
  })
  .catch(e => {
    if (numTries >= maxTries) {
      document.body.innerHTML = `<div style='padding: 10px 20px'><h1>Unauthorized</h1><h2>${e.error || e}</h2></div>`
    } else {
      alert(e.error || e)
      run()
    }
  })
}
run()

function getParams() {
  const params={}
  if (!window.location.search.length) return params
  window.location.search.substr(1).split("&").forEach(kv=>{
    const [key,value] = kv.split("=")
    params[key] = value
  })
  return params
}
</script>

</body>
</html>
