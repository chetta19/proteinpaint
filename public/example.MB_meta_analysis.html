<!DOCTYPE html>
<html>
<head>
	 <meta charset="utf-8">
</head>
<body>

<script src="bin/proteinpaint.js" charset="utf-8"></script>

<noscript>This page requires JavaScript. Please enable it in your browser settings.</noscript>

<div id=aaa style="margin:10px"></div>
<div id=exp style="margin:10px"></div>

<script>
document.body.onload = () => runproteinpaint({
	//host: 'https://ppr.stjude.org',
	holder:document.getElementById('aaa'),
	parseurl:true,
	nobox:1,
	noheader:1,
	debug: 1,
	mass:{
		state: {
			dslabel: 'MB_meta_analysis',
			genome: 'hg38',
			plots: [{
				chartType: 'survival',
				term: {
					id: 'Event-free Survival'
				},
				settings: {
					survival: {
						svgw: 1000,
						svgh: 400,
						symbol: 'vtick',
						timeUnit: 'years',
						xTickInterval: 5,
						atRiskVisible: true,
						atRiskLabelOffset: -20,
						xTickValues: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
					}
				}
			},{
				chartType: 'survival',
				term: {
					id: 'Overall Survival'
				},
				settings: {
					survival: {
						svgw: 1000,
						svgh: 400,
						symbol: 'vtick',
						timeUnit: 'years',
						xTickInterval: 1,
						atRiskVisible: true,
						atRiskLabelOffset: -20,
						xTickValues: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
					}
				}
			},{
				chartType: 'survival',
				term: {
					id: 'Progression-free Survival'
				},
				settings: {
					survival: {
						svgw: 1000,
						svgh: 400,
						symbol: 'vtick',
						timeUnit: 'years',
						xTickInterval: 1,
						atRiskVisible: true,
						atRiskLabelOffset: -20,
						xTickValues: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
					}
				}
			},
			{
				chartType: 'matrix',
				settings: {
					matrix: {
						colw: 6,
						colspace: 0,
            rowspace: 0,
						termLabelOffset: 220,
						sortTermsBy: 'asListed',
            grpLabelFontSize: 13,
            //sampleNameFilter: '_D1$'
					}
				},
				menuOpts: {
					sampleGroup: [
						{
							label: 'Survival plot',
							callback: 'launchSurvivalPlot',
							config: {
								//term2: {id: 'Primary Treatment category 2'},
								settings: {
									survival: {
										svgw: 1000,
										svgh: 400,
										symbol: 'vtick',
										timeUnit: 'years',
										xTickInterval: 1,
										atRiskVisible: true,
										atRiskLabelOffset: -20,
										xTickValues: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]
									}
								}
							}
						}
					]
				},
				termgroups: [
					{
						name: '',
						lst: [
							{
								id: 'Age',
								q: {
									mode: 'continuous',
								},
                settings: {
                  barh: 40,
                  gap: 10
                }
							},
							{
								label: 'Age Group',
                id: 'Age',
								q: {
									mode: 'discrete',
									type: 'custom-bin',
									lst: [{
										label: '<3',
										startunbounded: true,
										startinclusive: true,
										stopinclusive: false,
										stop: 3
									},{
										label: '3 to <7',
										startinclusive: true,
										stopinclusive: false,
										start: 3,
										stop: 7
									},{
										label: '7 to 18',
										startinclusive: true,
										stopinclusive: false,
										start: 7,
										stopunbounded: true,
									}]
								}
							},
							{
								id: 'Sex',
							},
							{
								id: 'Mstage'
							},
							{
								id: 'Mstatus'
							},
							{
								id: 'ACNS0332STRATUM'
							},
							{
								id: 'AnaplasticIndc'
							},
							{
								id: 'ACNS0331CSIgroup'
							},
							{
								id: 'ACNS0331RTgroup'
							},
							{
								id: 'ACNS0332CarboIndc'
							},
							{
								id: 'ExtentofResection'
							},
							
							{
								id: 'SJMB03Histology'
							},
							{
								id: 'KeyComps_MinusCarbo'
							},
							{
								id: 'abstract figure'
							},
							{
								id: 'Subgroup'
							},              
							{
                id: 'Subtype'
              },
              {  
                id: 'Study'
              },
							{
								id: 'Sequencing'
							},
							{
								id: 'Methylation'
							}
						]
					},

				 	{
            name: 'Cytogenetics',
            lst: getCytogeneticsData()
          },

          ...genegroups
				],

				// each override may be used by any termwrapper 
        // that has a tw.overrides[$key] array of any twOverride[$key] below
        overrides: {
          WESfill: {
            value: {
              key: 'Sequencing', 
              //value: 'WES', 
              values: [
                {key: 'Not tested', label: 'Not tested', color: '#fff', order: 10000}
              ]
            },
            sampleFilter: {
              type: 'tvs', // "wrapper-value-setting"
              tvs: {
                term: {id: 'Sequencing'},
                values: [{key: 'Not_available'}]
              }
            }
          },
          CNVfill: {
            value: {
              key: 'Methylation', 
              //value: 'Methylation', 
              values: [
                {key: 'Not tested', label: 'Not tested', color: '#fff', order: 10000}
              ]
            },
            sampleFilter: {
              type: 'tvs', // "wrapper-value-setting"
              tvs: {
                term: {id: 'Methylation'},
                values: [{key: 'No'}]
              }
            }
          }
        },
			}],
		}
	}
})

function getCytogeneticsData() {
	const chrs = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22] //,'X','Y']
	const lst = []
	for(const c of chrs) {
		if (c != 13 && c != 14 && c != 15 && c != 21 && c != 22) lst.push({id: `${c}p`, legend: {group: 'Cytogenetics'}})
		lst.push({id: `${c}q`, legend: {group: 'Cytogenetics'}})
	}
	return lst
}

const genegroups = [{
	name: 'Copy Number Variation',
	settings: {
    minNumSamples: 2
  },
	valueFilter: {
    type: 'tvs',
    tvs: {
      values: [{key: 'dt', value: 4}]
    },
  },
 	overrides: ['CNVfill'],
	lst: `CCND2
		CDK4
		CDK6
		FGFR1
		GFI1B
		GLI2
		KRAS
		LMO4
		MCL1
		MDM2
		MDM4
		MYC
		MYCL
		MYCN
		OTX2
		PPM1D
		PRDM6
		RB1
		TERT`.split('\n').map(g => {
			return {term: {name: g.trim(), type: 'geneVariant'}}
		}),
},{
	name: 'Somatic Mutations',
	settings: {
    minNumSamples: 2
  },
  valueFilter: {
    type: 'tvs',
    isnot: true,
    tvs: {
      values: [{key: 'dt', value: 4}]
    },
  },
  overrides: ['WESfill'],
	lst: `CTNNB1
		MYCN
		DDX3X
		PTCH1
		SMARCA4
		TP53
		OTX2
		KDM6A
		MYC
		KBTBD4
		KMT2D
		GSE1
		KMT2C
		ELP1
		CREBBP
		GLI2
		TBR1
		PTEN
		ZMYM3
		SUFU
		SMO
		ARID1A
		CTDNEP1
		APC
		EPHA7
		PIK3CA
		ATM
		BCOR
		BRCA2
		ZIC1
		GPR161
		PRDM6
		TCF4
		TERT`
		.split('\n')
		.map(g => {
			return {term: {name: g.trim(), type: 'geneVariant'}}
		})
}]

</script>

</body>
</html>
