<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
</head>

<body>

    <script src="https://ppr.stjude.org/bin/proteinpaint.js" charset="utf-8"></script>

    <noscript>This page requires JavaScript. Please enable it in your browser settings.</noscript>

    <div id=aaa style="margin:10px"></div>
    <div id=exp style="margin:10px"></div>

    <script>
        document.body.onload = () => runproteinpaint({
            host: 'https://ppr.stjude.org',
            holder: document.getElementById('aaa'),
            parseurl: true,
            nobox: 1,
            noheader: 1,
            debug: 1,
            mass: {
                state: {
                    dslabel: 'IHG',
                    genome: 'hg19',
                    /*   termfilter: {
                         filter: {
                           type: 'tvslst',
                           lst: [{
                             type: 'tvs',
                             tvs: {
                               term: {id: 'Sample Type'},
                               values: [{key: 'D1'}]
                             }
                           }]
                         }
                       },*/
                    plots: [
                        {
                            chartType: 'matrix',
                            settings: {
                                matrix: {
                                    colw: 8,
                                    colspace: 0,
                                    rowspace: 0,
                                    termLabelOffset: 220,
                                    sortTermsBy: 'asListed',
                                    grpLabelFontSize: 13,
                                    //sampleNameFilter: '_D1$'
                                }
                            },
                            menuOpts: {
                                sampleGroup: [
                                    {
                                        label: 'Survival plot',
                                        callback: 'launchSurvivalPlot',
                                        config: {
                                            //term2: {id: 'Primary Treatment category 2'},
                                            settings: {
                                                survival: {
                                                    xTickValues: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30]
                                                }
                                            }
                                        }
                                    }
                                ]
                            },
                            /*divideBy: {
                                id: 'TSNE Category'
                            },*/
                            termgroups: [
                                {
                                    name: '',
                                    lst: [
                                        {
                                            id: 'Age',
                                            q: {
                                                mode: 'continuous',
                                            },
                                            settings: {
                                                barh: 40,
                                                gap: 10
                                            }
                                        },
                                        {
                                            label: 'Age Group',
                                            id: 'Age',
                                            q: {
                                                mode: 'discrete',
                                                type: 'custom-bin',
                                                lst: [{
                                                    label: '<3',
                                                    startunbounded: true,
                                                    startinclusive: true,
                                                    stopinclusive: false,
                                                    stop: 3
                                                }, {
                                                    label: '3 to <7',
                                                    startinclusive: true,
                                                    stopinclusive: false,
                                                    start: 3,
                                                    stop: 7
                                                }, {
                                                    label: '7 to 18',
                                                    startinclusive: true,
                                                    stopinclusive: false,
                                                    start: 7,
                                                    stopunbounded: true,
                                                }]
                                            }
                                        },
                                        {
                                            id: 'Gender',
                                            q: { mode: 'values' } // or 'groupsetting'
                                        },
                                        { id: 'Anatomical Location of Tumor Tier 2' },
                                        { id: 'Extent of Resection-1' },
                                        { id: 'M0/M+' },
                                        { id: 'Primary Treatment ' },
                                        { id: 'Risk Category' },
                                        { id: 'Progresssive Disease' },
                                        { id: 'Ever Used Radiation During Treatment Course' },
                                        { id: 'Fusion Types Tier 1 ' },
                                        { id: 'Methylation' },
                                        { id: 'RNA-Seq' },
                                        { id: 'WES' },
                                        { id: 'Radiological Diagnosis By Blinded Radiologist-TIER-1' },
                                        { id: 'Histology Documented at Diagnosis' },
                                        { id: 'Histology Re-Review' },
                                        { id: 'FISH' },
                                        { id: 'IHC' },
                                        { id: 'TSNE-Cluster' },
                                        { id: 'MNP - Molecular CLASS' },
                                        { id: 'Integrated  Tier 4 Diagnosis' },
                                        { id: 'Integrated Tier 3 Diagnosis' },
                                    ]
                                },
                                {
                                    name: 'Cytogenetics',
                                    lst: getCytogeneticsData()
                                },
                                ...getGeneTermGroups(),
                            ],
                            // each override may be used by any termwrapper 
                            // that has a tw.overrides[$key] array of any twOverride[$key] below
                            overrides: {
                                SVfill: {
                                    value: {
                                        key: 'RNA-Seq',
                                        values: [
                                            { key: 'Not tested', label: 'Not tested', color: '#fff' }
                                        ]
                                    },
                                    sampleFilter: {
                                        type: 'tvs',
                                        tvs: {
                                            term: { id: 'RNA-Seq' },
                                            values: [{ key: 'No' }]
                                        }
                                    }
                                },
                                /*Germfill: {
                                  value: {
                                    key: 'Germline', 
                                    values: [
                                      {key: 'Not tested', label: 'Not tested', color: '#fff', order: 10000}
                                    ]
                                  },
                                  sampleFilter: {
                                    type: 'tvs', // "wrapper-value-setting"
                                    tvs: {
                                      term: {id: 'Germline'},
                                      values: [{key: 'No'}]
                                    }
                                  }
                                },*/
                                WESfill: {
                                    value: {
                                        key: 'WES',
                                        values: [
                                            { key: 'Not tested', label: 'Not tested', color: '#fff', order: 10000 }
                                        ]
                                    },
                                    sampleFilter: {
                                        type: 'tvs', // "wrapper-value-setting"
                                        tvs: {
                                            term: { id: 'WES' },
                                            values: [{ key: 'No' }]
                                        }
                                    }
                                },
                                CNVfill: {
                                    value: {
                                        key: 'Methylation',
                                        values: [
                                            { key: 'Not tested', label: 'Not tested', color: '#fff', order: 10000 }
                                        ]
                                    },
                                    sampleFilter: {
                                        type: 'tvs', // "wrapper-value-setting"
                                        tvs: {
                                            term: { id: 'Methylation' },
                                            values: [{ key: 'No' }]
                                        }
                                    }
                                }
                            }
                        },

                        {
                            chartType: 'survival',
                            term: {
                                id: 'Event-free survival'
                            },
                            settings: {
                                survival: {
                                    xTickValues: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30]
                                }
                            }
                        },

                        {
                            chartType: 'survival',
                            term: {
                                id: 'Overall Survival'
                            },
                            // term2: {
                            // 	id: 'Age'
                            // },
                            settings: {
                                survival: {
                                    xTickValues: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30]
                                }
                            }
                        }
                    ]
                }
            }
        })

        const cnvGenes = `C19MC, MYCN, PDGFRA, MET, MDM4, CDKN2A/B, PDGFB, MYCL, GFI1B, PTCH1, NF1`.split(',').map(g => g.trim())

        function getGeneTermGroups() {
            const termgroups = []
            for (const g of genegroups) {
                const grp = {
                    name: g.name,
                    overrides: g.overrides,
                    valueFilter: g.valueFilter,
                    lst: g.lst.map(t => {
                        const term = { name: t.name, type: 'geneVariant' }
                        const tw = { term }
                        if ('label' in t) tw.label = t.label
                        if ('minNumSamples' in t) tw.minNumSamples = t.minNumSamples
                        return tw
                    })
                }

                if (g.settings) grp.settings = g.settings
                termgroups.push(grp)
            }
            return termgroups
        }

        function getCytogeneticsData() {
            const chrs = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 'X', 'Y']
            const lst = []
            for (const c of chrs) {
                if (c != 13 && c != 14 && c != 15 && c != 21 && c != 22) lst.push({ id: `chr${c}p`, legend: { group: 'Cytogenetics' } })
                lst.push({ id: `chr${c}q`, legend: { group: 'Cytogenetics' } })
            }
            return lst
        }

        const genegroups = [
            {
                "name": "Fusion",
                valueFilter: {
                    type: 'tvs',
                    tvs: {
                        values: [{ key: 'dt', value: 2 }]
                    },
                },
                overrides: ['SVfill'],
                "lst": [
                    {
                        "name": "BCOR_SV",
                    },
                    {
                        "name": "CIC_SV"
                    },
                    {
                        "name": "MN1_SV"
                    },
                    {
                        "name": "NTRK1_SV"
                    },
                    {
                        "name": "NTRK2_SV"
                    },
                    {
                        "name": "NTRK3_SV"
                    },
                    {
                        "name": "ROS1_SV"
                    },
                    {
                        "name": "ALK_SV"
                    },
                    {
                        "name": "MET_SV"
                    },
                    {
                        "name": "ZFTA_SV"
                    },
                    {
                        "name": "MYBL1_SV"
                    },
                    {
                        "name": "FGFR2_SV"
                    },
                    {
                        "name": "PATZ1_SV"
                    }
                ]
            },
            {
                name: "Copy Number",
                valueFilter: {
                    type: 'tvs',
                    tvs: {
                        values: [{ key: 'dt', value: 4 }]
                    },
                },
                overrides: ['CNVfill'],
                lst: cnvGenes.map(name => { return { name } })
            },
            /*{
                "name": "Germline",
                overrides: ['Germfill'],
                "lst": [
                    {
                        "name": "DICER1_G"
                    },
                    {
                        "name": "ATM_G"
                    }
                ]
            },*/
            {
                "name": "Somatic",
                "settings": {
                    minNumSamples: 1
                },
                valueFilter: {
                    type: 'tvs',
                    isnot: true,
                    tvs: {
                        values: [{ key: 'dt', value: 4 }]
                    },
                },
                overrides: ['WESfill'],
                "lst": [
                    {
                        "name": "AFDN"
                    },
                    {
                        "name": "ALK"
                    },
                    {
                        "name": "APC"
                    },
                    {
                        "name": "ARID1A"
                    },
                    {
                        "name": "ARID2"
                    },
                    {
                        "name": "ASXL2"
                    },
                    {
                        "name": "ATF7IP"
                    },
                    {
                        "name": "ATRX"
                    },
                    {
                        "name": "BAZ1A"
                    },
                    {
                        "name": "BCL6"
                    },
                    {
                        "name": "BCL9"
                    },
                    {
                        "name": "BCOR"
                    },
                    {
                        "name": "BRAF"
                    },
                    {
                        "name": "CD22"
                    },
                    {
                        "name": "CHD7"
                    },
                    {
                        "name": "CREB3L1"
                    },
                    {
                        "name": "CTCF"
                    },
                    {
                        "name": "CTNNB1",
                        minNumSamples: 1
                    },
                    {
                        "name": "CUX1"
                    },
                    {
                        "name": "EZHIP"
                    },
                    {
                        "name": "DGCR8"
                    },
                    {
                        "name": "DICER1"
                    },
                    {
                        "name": "DMBT1"
                    },
                    {
                        "name": "EBF1"
                    },
                    {
                        "name": "EGFR"
                    },
                    {
                        "name": "ELL"
                    },
                    {
                        "name": "EP300"
                    },
                    {
                        "name": "ERBB4"
                    },
                    {
                        "name": "EZH2"
                    },
                    {
                        "name": "FAT1"
                    },
                    {
                        "name": "FGFR1"
                    },
                    {
                        "name": "FLI1"
                    },
                    {
                        "name": "GNA13"
                    },
                    {
                        "name": "GNAS"
                    },
                    {
                        "name": "NCOA2"
                    },
                    {
                        "name": "GSE1"
                    },
                    {
                        "name": "H3-3A"
                    },
                    {
                        "name": "H3C1"
                    },
                    {
                        "name": "HUWE1"
                    },
                    {
                        "name": "IDH2"
                    },
                    {
                        "name": "IKZF2"
                    },
                    {
                        "name": "JAK1"
                    },
                    {
                        "name": "JAK3"
                    },
                    {
                        "name": "KDR"
                    },
                    {
                        "name": "KIAA1549"
                    },
                    {
                        "name": "KMT2A"
                    },
                    {
                        "name": "KMT2D"
                    },
                    {
                        "name": "KRAS"
                    },
                    {
                        "name": "LATS1"
                    },
                    {
                        "name": "MAML2"
                    },
                    {
                        "name": "MGA"
                    },
                    {
                        "name": "MUTYH"
                    },
                    {
                        "name": "MYH11"
                    },
                    {
                        "name": "NAV1"
                    },
                    {
                        "name": "NDRG2"
                    },
                    {
                        "name": "NIPBL"
                    },
                    {
                        "name": "NOTCH1"
                    },
                    {
                        "name": "NR3C1"
                    },
                    {
                        "name": "NR4A3"
                    },
                    {
                        "name": "NSD1"
                    },
                    {
                        "name": "NTRK1"
                    },
                    {
                        "name": "NUP98"
                    },
                    {
                        "name": "MED12"
                    },
                    {
                        "name": "PALB2"
                    },
                    {
                        "name": "PDGFRA"
                    },
                    {
                        "name": "PDGFRB"
                    },
                    {
                        "name": "PIK3C2G"
                    },
                    {
                        "name": "PIK3CG"
                    },
                    {
                        "name": "PIK3R1"
                    },
                    {
                        "name": "POLD1"
                    },
                    {
                        "name": "PTEN"
                    },
                    {
                        "name": "PTPN2"
                    },
                    {
                        "name": "ROS1"
                    },
                    {
                        "name": "RPL11"
                    },
                    {
                        "name": "RUNX1T1"
                    },
                    {
                        "name": "SAMD9"
                    },
                    {
                        "name": "SEPTIN2"
                    },
                    {
                        "name": "SETBP1"
                    },
                    {
                        "name": "SETD2"
                    },
                    {
                        "name": "SHANK2"
                    },
                    {
                        "name": "SMARCC1"
                    },
                    {
                        "name": "SMO"
                    },
                    {
                        "name": "SRF"
                    },
                    {
                        "name": "STAG2"
                    },
                    {
                        "name": "TNFAIP3"
                    },
                    {
                        "name": "TP53"
                    },
                    {
                        "name": "TRAF7"
                    },
                    {
                        "name": "TSPYL2"
                    },
                    {
                        "name": "U2AF2"
                    },
                    {
                        "name": "USP6"
                    },
                    {
                        "name": "ZNF384"
                    },
                    {
                        "name": "C19MC"
                    },
                    {
                        "name": "MYC"
                    },
                    {
                        "name": "MET"
                    },
                    {
                        "name": "MDM4"
                    },
                    {
                        "name": "CDK4"
                    },
                    {
                        "name": "OTX2"
                    },
                    {
                        "name": "PPM1D"
                    },
                    {
                        "name": "PTCH1"
                    },
                    {
                        "name": "SUFU"
                    },
                    {
                        "name": "NF1"
                    },
                    {
                        "name": "MYCN"
                    }
                ]
            }
        ]

    </script>

</body>

</html>