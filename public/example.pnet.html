<!DOCTYPE html>
<html>
<head>
	 <meta charset="utf-8">
</head>
<body>

<script src="bin/proteinpaint.js" charset="utf-8"></script>

<noscript>This page requires JavaScript. Please enable it in your browser settings.</noscript>

<div id=aaa style="margin:10px"></div>
<div id=exp style="margin:10px"></div>

<script>
document.body.onload = () => runproteinpaint({
	//host: 'https://ppr.stjude.org',
	holder:document.getElementById('aaa'),
	parseurl:true,
	nobox:1,
	noheader:1,
	debug: 1,
	mass:{
		state: {
			dslabel: 'PNET',
			genome: 'hg19',
			plots: [
				{
					chartType: 'matrix',
					settings: {
						matrix: {
							colw: 8,
							colspace: 0,
              rowspace: 0,
							termLabelOffset: 220,
							sortTermsBy: 'asListed',
              grpLabelFontSize: 13
						}
					},
					menuOpts: {
						sampleGroup: [
							{
								label: 'Survival plot',
								callback: 'launchSurvivalPlot',
								config: {
									//term2: {id: 'Primary Treatment category 2'},
									settings: {
										survival: {
											xTickValues: [0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]
										}
									}
								}
							}
						]
					},
					divideBy: {
						id: 'TSNE Category'
					},
					termgroups: [
						{
							name: '',
							lst: [
								{
									id: 'Age',
									q: {
										mode: 'continuous',
									},
                  settings: {
                    barh: 40,
                    gap: 10
                  }
								},
								{
									label: 'Age Group',
                  id: 'Age',
									q: {
										mode: 'discrete',
										type: 'custom-bin',
										lst: [{
											label: '<3',
											startunbounded: true,
											startinclusive: true,
											stopinclusive: false,
											stop: 3
										},{
											label: '3 to <7',
											startinclusive: true,
											stopinclusive: false,
											start: 3,
											stop: 7
										},{
											label: '7 to 18',
											startinclusive: true,
											stopinclusive: false,
											start: 7,
											stopunbounded: true,
										}]
									}
								},
								{
									id: 'sex',
									//q: { mode: 'values' } // or 'groupsetting'
								},
								{
									id: 'Met'
								},
								{
									id: 'Death'
								},
								{
									id: 'PD'
								},
								{
									id: 'M stage'
								},
								{
									id: 'Primary Treatment category'
								},
								{
									id: 'Primary Treatment category 2'
								},
								{
									id: 'Surgery Prior to Therapy'
								},
								{
									id: 'Group'
								},
								{
									id: 'Histologic group at diagnosis'
								},
								{
									id: 'TSNE Category'
								},
								{
									id: 'TSNE closest cluster'
								},
								{
									id: 'DKFZ 12.5 Prediction Simplified'
								},
                {
                  id: 'Sample Type'
                },
                {
                  label: 'Study',
                  id: 'study'
                },
								{
									id: 'Mutational Burden'
								},
								{
									id: 'Germline',
                  $id: 'germline'
								},
								{
									id: 'WES',
                  $id: 'WES'
								},
								{
									id: 'RNAseq',
                  $id: 'rnaseq'
								},
                {
                  id: 'Methylation'
                },
								...getCytogeneticsData()
							]
						},
						...getGeneTermGroups(),
					],
          // each override may be used by any termwrapper 
          // that has a tw.overrides[$key] array of any twOverride[$key] below
          overrides: {
            SVfill: {
              value: {
                key: 'RNAseq', 
                value: 'RNAseq', 
                values: [
                  {key: 'Not tested', label: 'Not tested', color: '#fff'}
                ]
              },
              sampleFilter: {
                type: 'wvs', // "wrapper-value-setting"
                wrapper$id: 'rnaseq',
                values: [{key: 'No'}]
              }
            },
            Gfill: {
              value: {
                key: 'Germline', 
                value: 'Germline', 
                values: [
                  {key: 'Not tested', label: 'Not tested', color: '#fff'}
                ]
              },
              sampleFilter: {
                type: 'wvs', // "wrapper-value-setting"
                wrapper$id: 'germline',
                values: [{key: 'No'}]
              }
            },
            WESfill: {
              value: {
                key: 'WES', 
                value: 'WES', 
                values: [
                  {key: 'Not tested', label: 'Not tested', color: '#fff'}
                ]
              },
              sampleFilter: {
                type: 'wvs', // "wrapper-value-setting"
                wrapper$id: 'WES',
                values: [{key: 'No'}]
              }
            }
          }
				},

				/*{
					chartType: 'survival',
					term: {
						id: 'Event-free survival'
					},
					term2: {
					  id: 'Met'
					},
					settings: {
						survival: {
							xTickValues: [0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]
						}
					}
				},

				{
					chartType: 'survival',
					term: {
						id: 'Overall Survival'
					},
					// term2: {
					// 	id: 'Age'
					// },
					settings: {
						survival: {
							xTickValues: [0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30]
						}
					}
				},*/
			]
		}
	}
})

function getGeneTermGroups() {
	const termgroups = []
	for(const g of genegroups) {
		termgroups.push({
			name: g.name,
			lst: g.lst.map(term => {
				term.type = 'geneVariant'
				const tw = {term}
        const [name, suffix] = term.name.split('_')
        if (suffix == 'SV') {
          tw.overrides = ['SVfill']
        } else if (suffix == 'G') {
          tw.overrides = ['Gfill']
        } else {
          tw.overrides = ['WESfill']
        }

				return tw
			}),
      sortTermsBy: 'sampleCount'
		})
	}
	return termgroups
}

function getCytogeneticsData() {
	const chrs = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,'X','Y']
	const lst = []
	for(const c of chrs) {
		if (c != 13 && c != 14 && c != 15 && c != 21 && c != 22) lst.push({id: `chr${c}p`})
		lst.push({id: `chr${c}q`})
	}
	return lst
}

const genegroups = [
  {
      "name": "fusion",
      "lst": [
          {
              "name": "BCOR_SV",
          },
          {
              "name": "CIC_SV"
          },
          {
              "name": "TTYH1_SV"
          },
          {
              "name": "ATXN1_SV"
          },
          {
              "name": "C19MC_SV"
          },
          {
              "name": "KDM2B_SV"
          }
      ]
  },
  {
      "name": "Germline",
      "lst": [
          {
              "name": "DICER1_G"
          },
          {
              "name": "ATM_G"
          }
      ]
  },
  {
      "name": "Somatic",
      "lst": [
          {
              "name": "AFDN"
          },
          {
              "name": "ALK"
          },
          {
              "name": "APC"
          },
          {
              "name": "ARID1A"
          },
          {
              "name": "ARID2"
          },
          {
              "name": "ASXL2"
          },
          {
              "name": "ATF7IP"
          },
          {
              "name": "ATRX"
          },
          {
              "name": "BAZ1A"
          },
          {
              "name": "BCL6"
          },
          {
              "name": "BCL9"
          },
          {
              "name": "BCOR"
          },
          {
              "name": "BRAF"
          },
          {
              "name": "CD22"
          },
          {
              "name": "CHD7"
          },
          {
              "name": "CREB3L1"
          },
          {
              "name": "CTCF"
          },
          {
              "name": "CTNNB1"
          },
          {
              "name": "CUX1"
          },
          {
              "name": "EZHIP"
          },
          {
              "name": "DGCR8"
          },
          {
              "name": "DICER1"
          },
          {
              "name": "DMBT1"
          },
          {
              "name": "EBF1"
          },
          {
              "name": "EGFR"
          },
          {
              "name": "ELL"
          },
          {
              "name": "EP300"
          },
          {
              "name": "ERBB4"
          },
          {
              "name": "EZH2"
          },
          {
              "name": "FAT1"
          },
          {
              "name": "FGFR1"
          },
          {
              "name": "FLI1"
          },
          {
              "name": "GNA13"
          },
          {
              "name": "GNAS"
          },
          {
              "name": "NCOA2"
          },
          {
              "name": "GSE1"
          },
          {
              "name": "H3-3A"
          },
          {
              "name": "H3C1"
          },
          {
              "name": "HUWE1"
          },
          {
              "name": "IDH2"
          },
          {
              "name": "IKZF2"
          },
          {
              "name": "JAK1"
          },
          {
              "name": "JAK3"
          },
          {
              "name": "KDR"
          },
          {
              "name": "KIAA1549"
          },
          {
              "name": "KMT2A"
          },
          {
              "name": "KMT2D"
          },
          {
              "name": "KRAS"
          },
          {
              "name": "LATS1"
          },
          {
              "name": "MAML2"
          },
          {
              "name": "MGA"
          },
          {
              "name": "MUTYH"
          },
          {
              "name": "MYH11"
          },
          {
              "name": "NAV1"
          },
          {
              "name": "NDRG2"
          },
          {
              "name": "NIPBL"
          },
          {
              "name": "NOTCH1"
          },
          {
              "name": "NR3C1"
          },
          {
              "name": "NR4A3"
          },
          {
              "name": "NSD1"
          },
          {
              "name": "NTRK1"
          },
          {
              "name": "NUP98"
          },
          {
              "name": "MED12"
          },
          {
              "name": "PALB2"
          },
          {
              "name": "PDGFRA"
          },
          {
              "name": "PDGFRB"
          },
          {
              "name": "PIK3C2G"
          },
          {
              "name": "PIK3CG"
          },
          {
              "name": "PIK3R1"
          },
          {
              "name": "POLD1"
          },
          {
              "name": "PTEN"
          },
          {
              "name": "PTPN2"
          },
          {
              "name": "ROS1"
          },
          {
              "name": "RPL11"
          },
          {
              "name": "RUNX1T1"
          },
          {
              "name": "SAMD9"
          },
          {
              "name": "SEPTIN2"
          },
          {
              "name": "SETBP1"
          },
          {
              "name": "SETD2"
          },
          {
              "name": "SHANK2"
          },
          {
              "name": "SMARCC1"
          },
          {
              "name": "SMO"
          },
          {
              "name": "SRF"
          },
          {
              "name": "STAG2"
          },
          {
              "name": "TNFAIP3"
          },
          {
              "name": "TP53"
          },
          {
              "name": "TRAF7"
          },
          {
              "name": "TSPYL2"
          },
          {
              "name": "U2AF2"
          },
          {
              "name": "USP6"
          },
          {
              "name": "ZNF384"
          },
          {
              "name": "C19MC"
          },
          {
              "name": "GFI1B"
          },
          {
              "name": "MYC"
          },
          {
              "name": "MET"
          },
          {
              "name": "MDM4"
          },
          {
              "name": "CDK4"
          },
          {
              "name": "OTX2"
          },
          {
              "name": "PPM1D"
          },
          {
              "name": "PTCH1"
          },
          {
              "name": "SUFU"
          },
          {
              "name": "NF1"
          },
          {
              "name": "MYCN"
          }
      ]
  }
]

</script>

</body>
</html>
